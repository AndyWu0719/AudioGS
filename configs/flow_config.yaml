# Stage04: Flow Matching on codec latents (text-conditioned)

data:
  latent_dir: "data/latents/LibriTTS_R/train-clean-100"
  normalizer_path: "data/latents/LibriTTS_R/train-clean-100/latent_stats.pt"
  speaker_map: "data/latents/LibriTTS_R/train-clean-100/speaker_to_id.json"
  val_ratio: 0.01
  batch_size: 16            # per GPU
  num_workers: 8

model:
  latent_dim: 128
  hidden_dim: 512
  num_layers: 8
  num_heads: 8
  dropout: 0.1
  use_cross_attention: true
  num_speakers: 500

text_encoder:
  embed_dim: 256
  hidden_dim: 512
  num_layers: 6
  num_heads: 8

flow:
  sigma_min: 1.0e-4
  use_ot: false
  solver_method: "rk4"

training:
  max_steps: 250000
  warmup_steps: 5000
  learning_rate: 2.0e-4
  weight_decay: 1.0e-2
  grad_clip: 1.0
  log_interval: 50
  val_interval: 2000
  save_interval: 10000
  duration_loss_weight: 0.1
  num_sampling_steps: 25

codec:
  checkpoint: "logs/codec/checkpoints/final.pt"
  config: "configs/codec_config.yaml"

output:
  dir: "logs/flow_latent"
  sample_rate: 24000
